<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>CodeBot Chat</title>
  <style>
    body {
      background-color: #1e1e2f;
      font-family: 'Courier New', monospace;
      color: #d4d4d4;
      margin: 0;
      display: flex;
      height: 100vh;
    }
    .sidebar {
      width: 270px;
      background-color: #11111a;
      padding: 20px;
      border-right: 2px solid #00f7ff33;
      height: 100vh;
      overflow-y: auto;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      position: relative;
    }
    .sidebar h2 {
      font-size: 18px;
      color: #00f7ff;
      margin: 0 0 10px 0;
      user-select: none;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .sidebar h2 a {
      font-size: 14px;
      color: #00c8ff;
      text-decoration: none;
      cursor: pointer;
      margin-left: 10px;
    }
    .sidebar h2 a:hover {
      text-decoration: underline;
    }
    .credits-display {
      background: #222233;
      color: #00f7ff;
      padding: 10px 15px;
      border-radius: 6px;
      font-weight: bold;
      margin-bottom: 15px;
      text-align: center;
      user-select: none;
      box-shadow: 0 0 8px #00f7ff88;
    }
    .new-chat-btn {
      background: #00f7ff;
      color: #0e0e17;
      padding: 8px 12px;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      margin-bottom: 15px;
      text-align: center;
      user-select: none;
      transition: background-color 0.2s;
    }
    .new-chat-btn:hover {
      background: #00c8ff;
    }
    .chat-history {
      list-style: none;
      padding: 0;
      margin: 0;
      flex-grow: 1;
      overflow-y: auto;
    }
    .chat-history li {
      margin-bottom: 10px;
      background-color: #2c2c3a;
      padding: 8px 10px 8px 8px;
      border-radius: 6px;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.2s;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
    }
    .chat-history li:hover,
    .chat-history li.selected {
      background-color: #3c3c4a;
    }
    .chat-history li .title {
      flex-grow: 1;
      padding-right: 10px;
    }
    .chat-history li .menu-btn {
      background: transparent;
      border: none;
      color: #00f7ff;
      font-weight: bold;
      cursor: pointer;
      font-size: 18px;
      line-height: 1;
      padding: 0 5px;
      user-select: none;
      transition: color 0.2s;
    }
    .chat-history li .menu-btn:hover {
      color: #00c8ff;
    }
    .main {
      flex: 1;
      padding: 20px;
      display: flex;
      flex-direction: column;
      box-sizing: border-box;
      height: 100vh;
    }
    h1 {
      text-align: center;
      color: #00f7ff;
      margin: 0 0 20px 0;
      user-select: none;
    }
    .chatbox {
      background: #2c2c3a;
      padding: 20px;
      border-radius: 10px;
      flex: 1;
      overflow-y: auto;
      box-shadow: 0 0 10px #00ffae44;
      white-space: pre-wrap;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .bubble {
      padding: 12px 16px;
      border-radius: 10px;
      max-width: 90%;
      word-wrap: break-word;
    }
    .bot {
      background-color: #262c34;
      color: #00f7ff;
      text-align: left;
      border-left: 4px solid #00f7ff;
      align-self: flex-start;
      white-space: pre-wrap;
    }
    .user {
      background-color: #1f4037;
      color: #afff9f;
      text-align: right;
      border-right: 4px solid #afff9f;
      align-self: flex-end;
      white-space: pre-wrap;
    }
    .input-container {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    #input {
      flex: 1;
      padding: 10px 14px;
      font-size: 15px;
      border: none;
      border-radius: 8px;
      background-color: #1a1a28;
      color: #d4d4d4;
      box-shadow: inset 0 0 5px #00f7ff33;
      outline: none;
    }
    button {
      background-color: #00f7ff;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      color: #0e0e17;
      transition: background-color 0.2s;
    }
    button:hover {
      background-color: #00c8ff;
    }
    /* Contextmenu styling */
    #contextMenu {
      position: absolute;
      background: #262c34;
      border: 1px solid #00f7ff;
      border-radius: 6px;
      padding: 6px 0;
      display: none;
      z-index: 1000;
      width: 120px;
      box-shadow: 0 0 10px #00f7ff77;
      user-select: none;
    }
    #contextMenu button {
      width: 100%;
      background: transparent;
      border: none;
      color: #00f7ff;
      padding: 8px 16px;
      text-align: left;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s;
    }
    #contextMenu button:hover {
      background-color: #00c8ff;
      color: #0e0e17;
    }

    .disabled-link {
  pointer-events: none;    /* maakt klikken onmogelijk */
  color: gray;             /* maakt het visueel 'uitgeschakeld' */
  cursor: default;         /* verandert cursor naar standaard */
  text-decoration: none;   /* optioneel: verwijdert onderstreping */
}
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>
      üìÅ Je chats
      <a href="inlog.html" title="Inloggen">Inloggen</a>
     <a href="abonnement.html" class="disabled-link">Abonnementen & Credits</a>
    </h2>

    <!-- Credits display -->
    <div class="credits-display">
      Credits: <span id="creditsCount">0</span>
    </div>

    <div class="new-chat-btn" id="newChatBtn">+ Nieuwe chat</div>
    <ul class="chat-history" id="chatHistory"></ul>

    <!-- Contextmenu -->
    <div id="contextMenu">
      <button id="renameBtn">Naam wijzigen</button>
      <button id="deleteBtn">Verwijderen</button>
    </div>
  </div>

  <div class="main">
    <h1>üë®‚Äçüíª CodeBot Chat</h1>
    <div class="chatbox" id="chat">
      <div class="bubble bot">Hallo! Wat wil je dat ik voor je programmeer? Stuur alle details in 1 bericht anders krijg ik errors! ‚ú®</div>
    </div>

    <div class="input-container">
      <input id="input" placeholder="Typ je opdracht..." autocomplete="off" />
      <button id="sendBtn">Verzenden</button>
    </div>
  </div>

<script>
  const STORAGE_KEY = 'chatConversations';
  const CREDITS_KEY = 'userCredits';

  let conversations = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
  let currentChatId = null;
  let contextMenuChatId = null;

  // Initialize credits if not present
  if (localStorage.getItem(CREDITS_KEY) === null) {
    localStorage.setItem(CREDITS_KEY, '0');
  }

  function updateCredits() {
    const credits = parseInt(localStorage.getItem(CREDITS_KEY) || '0', 10);
    const creditsCountElem = document.getElementById('creditsCount');
    creditsCountElem.textContent = credits;

    // Optional: kleur rood als bijna geen credits
    if (credits < 3) {
      creditsCountElem.style.color = '#ff5555';
    } else {
      creditsCountElem.style.color = '#00f7ff';
    }
  }

  // Add credits (e.g. after purchase or for testing)
  function addCredits(amount) {
    let credits = parseInt(localStorage.getItem(CREDITS_KEY) || '0', 10);
    credits += amount;
    localStorage.setItem(CREDITS_KEY, credits.toString());
    updateCredits();
  }

  // Create a new chat with default name 'Chat N'
  function createNewChat() {
    const newIndex = conversations.length + 1;
    const newChat = {
      id: Date.now().toString(),
      messages: [
        { sender: 'user', text: `Chat ${newIndex}` },
        { sender: 'bot', text: 'Hallo! Wat wil je dat ik voor je programmeer? Stuur alle details in 1 bericht anders krijg ik errors! ‚ú®' }
      ],
      createdAt: Date.now()
    };
    conversations.push(newChat);
    saveConversations();
    setCurrentChat(newChat.id);
    renderSidebar();
  }

  function saveConversations() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(conversations));
  }

  function renderSidebar() {
    const list = document.getElementById('chatHistory');
    list.innerHTML = '';

    conversations.forEach(conv => {
      const li = document.createElement('li');
      li.dataset.id = conv.id;
      li.classList.toggle('selected', conv.id === currentChatId);

      // Use the first user message text as the chat title or fallback name
      const firstUserMsg = conv.messages.find(m => m.sender === 'user');
      const title = firstUserMsg ? firstUserMsg.text : 'Nieuwe chat';

      const spanTitle = document.createElement('span');
      spanTitle.textContent = title;
      spanTitle.className = 'title';

      const menuBtn = document.createElement('button');
      menuBtn.textContent = '‚ãÆ';
      menuBtn.className = 'menu-btn';

      li.appendChild(spanTitle);
      li.appendChild(menuBtn);
      list.appendChild(li);

      // Click to select chat
      li.addEventListener('click', () => {
        setCurrentChat(conv.id);
      });

      // Context menu open
      menuBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        openContextMenu(e.pageX, e.pageY, conv.id);
      });
    });
  }

  function setCurrentChat(id) {
    currentChatId = id;
    renderSidebar();
    renderChat();
  }

  function renderChat() {
    const chat = document.getElementById('chat');
    chat.innerHTML = '';

    if (!currentChatId) return;

    const conv = conversations.find(c => c.id === currentChatId);
    if (!conv) return;

    conv.messages.forEach(msg => {
      const div = document.createElement('div');
      div.classList.add('bubble', msg.sender);
      div.textContent = msg.text;
      chat.appendChild(div);
    });

    chat.scrollTop = chat.scrollHeight;
  }

  function sendMessage() {
    const input = document.getElementById('input');
    const text = input.value.trim();
    if (!text || !currentChatId) return;

    // Check credits before sending (1 credit per message)
    let credits = parseInt(localStorage.getItem(CREDITS_KEY) || '0', 10);
    if (credits < 1) {
      alert('Je hebt geen credits meer. Koop er meer in je account.');
      return;
    }

    // Deduct credit
    credits -= 1;
    localStorage.setItem(CREDITS_KEY, credits.toString());
    updateCredits();

    // Add user message
    const conv = conversations.find(c => c.id === currentChatId);
    conv.messages.push({ sender: 'user', text });

    // Add bot reply (dummy for nu)
    const botReply = 'Dit is een dummy reactie die code genereert...';

    conv.messages.push({ sender: 'bot', text: botReply });

    saveConversations();
    renderChat();

    input.value = '';
    input.focus();
  }

  // Context menu
  const contextMenu = document.getElementById('contextMenu');
  const renameBtn = document.getElementById('renameBtn');
  const deleteBtn = document.getElementById('deleteBtn');

  function openContextMenu(x, y, chatId) {
    contextMenu.style.left = x + 'px';
    contextMenu.style.top = y + 'px';
    contextMenu.style.display = 'block';
    contextMenuChatId = chatId;
  }

  window.addEventListener('click', () => {
    contextMenu.style.display = 'none';
  });

  renameBtn.addEventListener('click', () => {
    const conv = conversations.find(c => c.id === contextMenuChatId);
    if (!conv) return;

    const firstUserMsg = conv.messages.find(m => m.sender === 'user');
    const oldName = firstUserMsg ? firstUserMsg.text : '';
    const newName = prompt('Geef de nieuwe naam van de chat:', oldName);

    if (newName && newName.trim()) {
      if (firstUserMsg) {
        firstUserMsg.text = newName.trim();
      } else {
        conv.messages.unshift({ sender: 'user', text: newName.trim() });
      }
      saveConversations();
      renderSidebar();
    }
    contextMenu.style.display = 'none';
  });

  deleteBtn.addEventListener('click', () => {
    const idx = conversations.findIndex(c => c.id === contextMenuChatId);
    if (idx !== -1) {
      if (confirm('Weet je zeker dat je deze chat wilt verwijderen?')) {
        conversations.splice(idx, 1);
        if (currentChatId === contextMenuChatId) {
          currentChatId = conversations.length ? conversations[0].id : null;
        }
        saveConversations();
        renderSidebar();
        renderChat();
      }
    }
    contextMenu.style.display = 'none';
  });

  document.getElementById('newChatBtn').addEventListener('click', createNewChat);
  document.getElementById('sendBtn').addEventListener('click', sendMessage);
  document.getElementById('input').addEventListener('keydown', e => {
    if (e.key === 'Enter') sendMessage();
  });

  // Test knop om credits toe te voegen (optioneel)
  // Plaats deze knop in je HTML met id="addCreditsBtn"
  const addCreditsBtn = document.getElementById('addCreditsBtn');
  if (addCreditsBtn) {
    addCreditsBtn.addEventListener('click', () => {
      addCredits(5);
      alert('5 credits toegevoegd!');
    });
  }

  // Listen for storage changes from other tabs/pages
  window.addEventListener('storage', (event) => {
    if (event.key === CREDITS_KEY) {
      updateCredits();
    }
  });

  // Update credits when page/tab gains focus
  window.addEventListener('focus', updateCredits);

  // Update credits when page becomes visible (e.g. tab switch)
  document.addEventListener('visibilitychange', () => {
    if (!document.hidden) updateCredits();
  });

  // Init
  if (conversations.length) {
    currentChatId = conversations[0].id;
  } else {
    createNewChat();
  }
  updateCredits();
  renderSidebar();
  renderChat();

  // Voor testen in console: addCredits(5);
</script>
</body>
</html>